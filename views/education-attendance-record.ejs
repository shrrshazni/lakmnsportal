<%- include("partials/private-header.ejs") %>

<style>
    .card-icon {
        position: absolute;
        top: 50%;
        right: 20px; 
        transform: translateY(-50%);
        font-size: 2rem; 
    }

    /* Custom checkbox styling */
    .attendance-checkbox-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .attendance-checkbox-wrapper label {
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        margin-right: 10px;
        font-size: 14px;
    }

    .attendance-checkbox {
        display: none;
    }

    .custom-checkbox {
        position: relative;
        width: 16px;  /* Reduced size */
        height: 16px; /* Reduced size */
        border: 2px solid #d1d1d1;
        border-radius: 3px;
        display: inline-block;
        margin-right: 8px;
        transition: all 0.2s ease;
    }

    /* Blue hover effect before checkbox is clicked */
    .attendance-checkbox:not(:disabled) + .custom-checkbox:hover {
        border-color: #2196F3; /* Blue hover color */
    }

    /* Green and red styles for present/absent */
    .custom-checkbox:before {
        content: '';
        position: absolute;
        width: 8px;   /* Adjusted size */
        height: 8px;  /* Adjusted size */
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0);
        background-color: transparent;
        border-radius: 2px;
        transition: transform 0.3s ease;
    }

    .custom-checkbox.checked-green:before {
        background-color: #4caf50; /* Green for present */
        transform: translate(-50%, -50%) scale(1);
    }

    .custom-checkbox.checked-red:before {
        background-color: #f44336; /* Red for absent */
        transform: translate(-50%, -50%) scale(1);
    }

    /* Disabled checkbox styles */
    .attendance-checkbox:disabled + .custom-checkbox {
        border-color: #aaa;
        background-color: #e0e0e0;
    }

    /* Disabled state hover removal */
    .attendance-checkbox:disabled + .custom-checkbox:hover {
        border-color: #aaa; /* No hover effect for disabled checkboxes */
    }

    /* Label styles */
    .attendance-checkbox-wrapper label {
        color: #555;
    }

    .attendance-checkbox:disabled + .custom-checkbox + label {
        color: #aaa; /* Grey out the text when disabled */
    }

    /* Media query for responsive */
    @media (max-width: 768px) {
        .filters {
            flex-direction: column;
        }
    }
</style>

<div class="row gy-3 mb-3 justify-content-between d-flex mt-0">
    <div class="col-md-9 col-auto">
        <h2 class="mb-2 text-body-emphasis">Attendance Record</h2>
        <h5 class="text-body-tertiary fw-semibold">We hope you have a great experience managing visitor entries and exits.</h5>
    </div>

    <!-- Student info button -->
    <div class="col-md-3 col-auto d-flex align-items-center justify-content-end">
        <div class="col-auto">
            <a class="btn btn-phoenix-primary" role="button" href="/tattary/student/information">Student Info</a>
        </div>
    </div>
</div>

<div class="row justify-content-between mb-6 mt-6">
    <div class="d-flex flex-fill col-md-4 col-xxl-2 text-center border-translucent border-end-0 border-md-end pb-4 pb-xxl-0">
        <div class="flex-grow-1">
            <span class="uil fs-5 lh-1 fa-solid fa-users-line text-primary"></span>
            <h1 class="fs-5 pt-3">25</h1>
            <p class="fs-9 mb-0">Total Students</p>
        </div>
    </div>
    <div class="d-flex flex-fill col-md-4 col-xxl-2 text-center border-translucent border-start border-end-0 border-md-end pb-4 pb-xxl-0">
        <div class="flex-grow-1">
            <span class="uil fs-5 lh-1 fa-solid fa-check text-success"></span>
            <h1 class="fs-5 pt-3">15</h1>
            <p class="fs-9 mb-0">Total Present</p>
        </div>
    </div>
    <div class="d-flex flex-fill col-md-4 col-xxl-2 text-center border-translucent border-start border-end border-end-md-0 pb-4 pb-xxl-0 pt-4 pt-md-0">
        <div class="flex-grow-1">
            <span class="uil fs-5 lh-1 fa-solid fa-times text-danger"></span>
            <h1 class="fs-5 pt-3">10</h1>
            <p class="fs-9 mb-0">Total Absent</p>
        </div>
    </div>
</div>

<div class="mx-n4 px-4 mx-lg-n6 px-lg-6 bg-body-emphasis pt-7 pb-3 border-y mb-6">
    <div id="" data-list=''>
        <div class="row align-items-end justify-content-between pb-4 g-3">
            <div class="filters d-flex justify-content-between align-items-center gap-3">
                <!-- Search -->
                <div class="position-relative" style="width: auto;">
                    <span class="fas fa-search search-box-icon" style="position: absolute; top: 50%; left: 10px; transform: translateY(-50%); color: #aaa;"></span>
                    <input type="search" class="form-control ps-5" id="searchInput" placeholder="Search" style="padding: 5px; font-size: 14px; border-radius: 8px; width: 200px;">
                </div>
                
                <!-- Class option -->
                <select id="" name="" class="form-select" style="width: 150px; padding: 5px; font-size: 14px; border-radius: 8px;">
                    <option value="">All Class</option>
                    <option value="">Class 1</option>
                    <option value="">Class 2</option>
                </select>
            
                <!-- Datepicker -->
                <div class="date ms-auto position-relative" style="padding-right: 0; width: auto;">
                    <span class="fa-regular fa-calendar-xmark" style="position: absolute; top: 50%; left: 12px; transform: translateY(-50%); color: #aaa; font-size: 12px;"></span>
                    <input type="text" class="form-control datetimepicker flatpickr-input ps-5" id="inputStartDate" placeholder="Select Date" name="startDate" data-options='' value="" style="padding: 5px 10px; font-size: 14px; border-radius: 8px; width: 200px;">
                </div>
            </div>
        </div>
        
        <div id="" data-list='{"page":10,"pagination":true}'>
            <div class="table-responsive ms-n1 ps-1 scrollbar">
                <table id="vis-table" class="table fs-9 mb-0 border-top border-translucent">
                    <thead>
                        <tr>
                            <th class="sort align-middle text-start" scope="col" data-sort="" style="width:5%;">STUDENT NAME</th>
                            <th class="sort align-middle text-center" scope="col" data-sort="" style="width:15%;">CLASS</th>
                            <th class="sort align-middle text-center" scope="col" data-sort="" style="width:15%;">ATTENDANCE</th>
                            <th class="sort align-middle text-center" scope="col" data-sort="" style="width:15%;">STATUS</th>
                            <th class="sort align-middle text-center" scope="col" data-sort="" style="width:15%;">REMARKS</th>
                            <th class="sort align-middle text-end" scope="col" style="width:5%;"></th>
                        </tr>
                    </thead>
                    <tbody id="">
                        <tr>
                            <!-- Example student 1 -->
                            <td class="align-middle text-start">
                                <a href="#" class="student-name text-decoration-none" data-bs-toggle="modal" data-bs-target="#studentModal">John Doe</a> 
                            </td>
                            <td class="align-middle text-center">Class 1</td>
                            <td class="align-middle text-center">
                                <div class="attendance-checkbox-wrapper">
                                    <label>
                                      <input type="checkbox" name="attendance1" id="present1" value="present" class="attendance-checkbox" data-status-id="status1">
                                      <span class="custom-checkbox"></span>
                                      Present
                                    </label>
                                    <label>
                                      <input type="checkbox" name="attendance1" id="absent1" value="absent" class="attendance-checkbox" data-status-id="status1">
                                      <span class="custom-checkbox red"></span>
                                      Absent
                                    </label>
                                </div>
                            </td>
                            <td class="align-middle text-center" id="status1">-</td>
                            <td class="align-middle text-center" id="remarks1"><em>No remarks yet</em></td>
                            <td class="align-middle text-end white-space-nowrap pe-0 action">
                                <div class="btn-reveal-trigger position-static">
                                    <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs-10" type="button" data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
                                        <span class="fas fa-ellipsis-h fs-10"></span>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end py-2">
                                        <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#updateRemarksModal" data-remark-id="remarks1">Add Remarks</a>
                                        <!-- <a class="dropdown-item edit-attendance-link d-none" href="#" data-student-id="1" data-attendance-status="present">Edit Attendance</a> -->
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <!-- Example student 2 -->
                            <td class="align-middle text-start">
                                <a href="#" class="student-name text-decoration-none" data-bs-toggle="modal" data-bs-target="#studentModal">Hello World</a> 
                            </td>
                            <td class="align-middle text-center">Class 1</td>
                            <td class="align-middle text-center">
                                <div class="attendance-checkbox-wrapper">
                                  <label>
                                    <input type="checkbox" name="attendance2" id="present2" value="present" class="attendance-checkbox" data-status-id="status2">
                                    <span class="custom-checkbox"></span>
                                    Present
                                  </label>
                                  <label>
                                    <input type="checkbox" name="attendance2" id="absent2" value="absent" class="attendance-checkbox" data-status-id="status2">
                                    <span class="custom-checkbox red"></span>
                                    Absent
                                  </label>
                                </div>
                            </td>
                            <td class="align-middle text-center" id="status2">-</td>
                            <td class="align-middle text-center" id="remarks2"><em>No remarks yet</em></td>
                            <td class="align-middle text-end white-space-nowrap pe-0 action">
                                <div class="btn-reveal-trigger position-static">
                                    <button class="btn btn-sm dropdown-toggle dropdown-caret-none transition-none btn-reveal fs-10" type="button" data-bs-toggle="dropdown" data-boundary="window" aria-haspopup="true" aria-expanded="false" data-bs-reference="parent">
                                        <span class="fas fa-ellipsis-h fs-10"></span>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end py-2">
                                        <a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#updateRemarksModal" data-remark-id="remarks2">Add Remarks</a>
                                        <!-- <a class="dropdown-item edit-attendance-link d-none" href="#" data-student-id="1" data-attendance-status="present">Edit Attendance</a> -->
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>  
                </table>
            </div>
        </div>
        <div class="row align-items-center justify-content-between py-2 pe-0 fs-9">
            <div class="col-auto d-flex">
                <p class="mb-0 d-none d-sm-block me-3 fw-semibold text-body" data-list-info="data-list-info"></p>
                <a class="fw-semibold" href="#!" data-list-view="*" id="">View all<span class="fas fa-angle-right ms-1" data-fa-transform="down-1"></span></a>
                <a class="fw-semibold d-none" href="#!" data-list-view="less" id="">View Less<span class="fas fa-angle-right ms-1" data-fa-transform="down-1"></span></a>
            </div>
            <div class="col-auto d-flex">
                <button class="page-link" data-list-pagination="prev"><span class="fas fa-chevron-left"></span></button>
                <ul class="mb-0 pagination"></ul>
                <button class="page-link pe-0" data-list-pagination="next"><span class="fas fa-chevron-right"></span></button>
            </div>
        </div>
    </div>
</div>

<!-- Modal to view more student details -->
<div class="modal fade" id="studentModal" tabindex="-1" aria-labelledby="studentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="studentModalLabel">Student Information</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Information about the student -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="fullname" class="form-label"><b>Student Name</b></label>
                        <p class="form-label">Alice Johnson</p>
                    </div>
                    <div class="col-md-6">
                        <label for="address" class="form-label"><b>Address</b></label>
                        <p class="form-label">1234 Elm St, Cityville</p>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="paidAmount" class="form-label"><b>IC Number</b></label>
                        <p class="form-label">990101-12-1234</p>
                    </div>
                    <div class="col-md-6">
                        <label for="paidAmount" class="form-label"><b>Date of Birth</b></label>
                        <p class="form-label">23-10-2013</p>
                    </div>
                </div>
                
                <hr>

                <!-- Information about the student's Parent -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="fullname" class="form-label"><b>Father's Name</b></label>
                        <p class="form-label">George</p>
                    </div>
                    <div class="col-md-6">
                        <label for="address" class="form-label"><b>Address</b></label>
                        <p class="form-label">1234 Elm St, Cityville</p>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="paidAmount" class="form-label"><b>IC Number</b></label>
                        <p class="form-label">990101-12-1234</p>
                    </div>
                    <div class="col-md-6">
                        <label for="paidAmount" class="form-label"><b>Phone Number</b></label>
                        <p class="form-label">0123456789</p>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="paidAmount" class="form-label"><b>Occupation</b></label>
                    <p class="form-label">Pilot</p>
                </div>
            
                <hr>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="fullname" class="form-label"><b>Mother's Name</b></label>
                        <p class="form-label">Sarah</p>
                    </div>
                    <div class="col-md-6">
                        <label for="address" class="form-label"><b>Address</b></label>
                        <p class="form-label">1234 Elm St, Cityville</p>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="paidAmount" class="form-label"><b>IC Number</b></label>
                        <p class="form-label">990101-12-1234</p>
                    </div>
                    <div class="col-md-6">
                        <label for="paidAmount" class="form-label"><b>Phone Number</b></label>
                        <p class="form-label">0123456789</p>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="paidAmount" class="form-label"><b>Occupation</b></label>
                    <p class="form-label">Nurse</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Updating Remarks -->
<div class="modal fade" id="updateRemarksModal" tabindex="-1" aria-labelledby="updateRemarksModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateRemarksModalLabel">Add Remarks</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            <form>
                <div class="mb-3">
                    <label for="remarksInput" class="form-label">Remarks</label>
                    <textarea class="form-control" id="remarksInput" placeholder="Enter remarks" rows="4"></textarea>
                </div>
            </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveRemarks">Add</button>
            </div>
        </div>
    </div>
</div>

<script>
    let currentRemarkId = null; // Store the current remark ID for the modal

    // Open modal and capture remark ID
    document.querySelectorAll('.dropdown-item[data-remark-id]').forEach(function(item) {
        item.addEventListener('click', function() {
            currentRemarkId = this.getAttribute('data-remark-id'); // Capture the remark ID for the clicked row
            const remarkText = document.getElementById(currentRemarkId).innerText.trim();
            document.getElementById('remarksInput').value = remarkText !== 'No remarks yet' ? remarkText : ''; // Pre-fill with existing remark if available
        });
    });

    // Handle the Save Remarks button click
    document.getElementById('saveRemarks').addEventListener('click', function() {
        const remarkInput = document.getElementById('remarksInput').value.trim();
        const remarksElement = document.getElementById(currentRemarkId);

        if (remarkInput) {
            // Update the remarks in the table
            remarksElement.innerHTML = `<span class="text-info">${remarkInput}</span>`;
        } else {
            // Default if no remark is provided
            remarksElement.innerHTML = `<em>No remarks yet</em>`;
        }

        // Close the modal after saving
        const modal = bootstrap.Modal.getInstance(document.getElementById('updateRemarksModal'));
        modal.hide();
    });

    // Handle the attendance checkbox
    document.querySelectorAll('.attendance-checkbox').forEach(function(checkbox) {
        checkbox.addEventListener('change', function() {
            const statusId = this.getAttribute('data-status-id');
            const statusElement = document.getElementById(statusId);
            const checkboxes = document.getElementsByName(this.name);

            // Get current time
            const currentTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            // Uncheck other checkboxes
            checkboxes.forEach(function(box) {
                if (box !== checkbox) {
                    box.checked = false;
                }
                // Disable all checkboxes after one is selected
                box.disabled = true;
            });
    
            // Update status based on the checkbox value and apply styling
            if (this.id.includes('present')) {
                if (this.checked) {
                    statusElement.innerHTML = `
                    <span class="badge badge-phoenix badge-phoenix-success fs-10 align-items-center">Present</span>
                    <br>
                    <span class="badge badge-phoenix badge-phoenix-warning fs-10 align-items-center">${currentTime}</span>`;
                } else {
                    statusElement.innerHTML = '-';
                }
                } else if (this.id.includes('absent')) {
                    if (this.checked) {
                        statusElement.innerHTML = `
                    <span class="badge badge-phoenix badge-phoenix-danger fs-10 align-items-center">Absent</span>
                    <br>
                    <span class="badge badge-phoenix badge-phoenix-warning fs-10 align-items-center">${currentTime}</span>`;
                } else {
                    statusElement.innerHTML = '-';
                }
            }
        });
    });

    document.addEventListener('DOMContentLoaded', function () {
      const checkboxes = document.querySelectorAll('.attendance-checkbox');
  
        checkboxes.forEach((checkbox) => {
            checkbox.addEventListener('change', function () {
                if (this.checked) {
                    // Disable both checkboxes (Present and Absent) once one is clicked
                    const statusId = this.getAttribute('data-status-id');
                    const relatedCheckboxes = document.querySelectorAll(`input[data-status-id="${statusId}"]`);
        
                    // Handle checkbox coloring and disabling
                    relatedCheckboxes.forEach(cb => {
                        cb.disabled = true; // Disable both checkboxes
                        const checkboxLabel = cb.nextElementSibling;
                        if (cb.checked && cb.value === "present") {
                            checkboxLabel.classList.add('checked-green'); // Show green for present
                        } else if (cb.checked && cb.value === "absent") {
                            checkboxLabel.classList.add('checked-red'); // Show red for absent
                        }
                    });
                }
            });
        });
    });

    // Handle the search input
    document.getElementById('searchInput').addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('#vis-table tbody tr');
        //let visibleRows = 0;
        
        rows.forEach(function(row) {
            const name = row.cells[0].textContent.toLowerCase(); // Student Name column
            const status = row.cells[3].textContent.toLowerCase(); // Status column
            
            if (name.includes(searchTerm) || status.includes(searchTerm)) {
                row.style.display = ''; // Show row if matches
                //visibleRows++;
            } else {
                row.style.display = 'none'; // Hide row if not matching
            }
        });

        // Check if any rows are visible
        // if (visibleRows === 0) {
        //     document.querySelector('#vis-table tbody').innerHTML = 
        //         '<tr><td colspan="12" style="text-align:center;">No search list found</td></tr>';
        // }
    });

    // Enable checkboxes when 'Edit Attendance' is clicked
    // document.querySelectorAll('.edit-attendance-link').forEach(function(editLink) {
    //     editLink.addEventListener('click', function(event) {
    //         event.preventDefault(); 

    //         // Enable the related checkboxes
    //         const studentId = this.getAttribute('data-student-id');
    //         const attendanceCheckboxes = document.querySelectorAll('input[name="attendance' + studentId + '"]');
            
    //         attendanceCheckboxes.forEach(function(checkbox) {
    //             checkbox.disabled = false; 
    //         });
    //     });
    // });

    // Initialize Datepicker
    // $(document).ready(function () {
    //     const today = new Date();
    //     const day = String(today.getDate()).padStart(2, '0');
    //     const month = String(today.getMonth() + 1).padStart(2, '0');
    //     const year = today.getFullYear();
    //     const currentDate = `${day}-${month}-${year}`;

    //     flatpickr("#inputStartDate", {
    //         defaultDate: currentDate,
    //         dateFormat: "d-m-Y", 
    //         disableMobile: true 
    //     });
    // });
</script>

<%- include('partials/private-footer.ejs') %>