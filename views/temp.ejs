<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Function to update chart based on selected month
    function updateChart(selectedMonth, leaveCounts) {
      // Extract the day numbers and corresponding counts from leaveCounts
      const xAxisData = Object.keys(leaveCounts);
      const approvedData = xAxisData.map(day => leaveCounts[day].approved);
      const deniedData = xAxisData.map(day => leaveCounts[day].denied);

      // ECharts option for the chart
      var leaveChart = echarts.init(document.getElementById('total-leave-chart'), null, {
        devicePixelRatio: window.devicePixelRatio > 1 ? 2 : 1,
        renderer: 'canvas',
        width: 'auto',
        height: 'auto'
      });

      var option = {
        responsive: true,
        color: [theme.primary, '#0097eb'],
        tooltip: {
          trigger: 'axis',
          padding: 10,
          backgroundColor: '#eff2f6',
          borderColor: '#cbd0dd',
          textStyle: {
            color: '#141824'
          },
          borderWidth: 1,
          transitionDuration: 0,
          axisPointer: {
            type: 'none'
          },
        },
        xAxis: [{
            type: 'category',
            data: xAxisData,
            axisLabel: {
              formatter: function(value) {
                return `Day ${value}`;
              },
              interval: 13,
              showMinLabel: true,
              showMaxLabel: false,
              color: '#3e465b',
              align: 'left',
              fontFamily: 'Nunito Sans',
              fontWeight: 600,
              fontSize: 12.8
            },
            axisLine: {
              show: true,
              lineStyle: {
                color: '#525b75',
                opacity: 0.5
              }
            },
            axisTick: {
              show: false
            },
            splitLine: {
              show: true,
              interval: 0,
              lineStyle: {
                color: '#525b75',
                opacity: 0.3
              }
            },
            boundaryGap: false
          },
          {
            type: 'category',
            position: 'bottom',
            data: xAxisData,
            axisLabel: {
              formatter: function(value) {
                return `Day ${value}`;
              },
              interval: 130,
              showMaxLabel: true,
              showMinLabel: false,
              color: '#3e465b',
              align: 'right',
              fontFamily: 'Nunito Sans',
              fontWeight: 600,
              fontSize: 12.8
            },
            axisLine: {
              show: false
            },
            axisTick: {
              show: false
            },
            splitLine: {
              show: false
            },
            boundaryGap: false
          }
        ],
        yAxis: {
          position: 'right',
          axisPointer: {
            type: 'none'
          },
          axisTick: 'none',
          splitLine: {
            show: false
          },
          axisLine: {
            show: false
          },
          axisLabel: {
            show: false
          }
        },
        series: [{
            name: 'Approved',
            type: 'line',
            data: approvedData,
            showSymbol: false,
            symbol: 'circle',
          },
          {
            name: 'Denied',
            type: 'line',
            data: deniedData,
            lineStyle: {
              type: 'dashed',
              width: 1,
              color: '#0097eb',
              opacity: 0.5,
            },
            showSymbol: false,
            symbol: 'circle',
          }
        ],
        grid: {
          right: 2,
          left: 5,
          bottom: '20px',
          top: '2%',
          containLabel: false
        }
      };

      // Set chart option and render
      leaveChart.setOption(option);

      window.addEventListener('resize', function() {
        leaveChart.resize();
      });
    }

    // Event listener for select change
    document.getElementById('select-month').addEventListener('change', function() {
      var selectedMonth = this.value;

      // Fetch data from the server
      const leaveTypeURL1 = `/api/leave-data-example/${selectedMonth}`;
      fetch(leaveTypeURL1)
        .then(response => response.json())
        .then(leaveCounts => {
          updateChart(selectedMonth, leaveCounts);
        })
        .catch(error => {
          console.error('Error fetching leave data:', error);
        });
    });

    // Initial chart update with default month (assuming 'January' is the default)
    updateChart('January', {});
  });
</script>