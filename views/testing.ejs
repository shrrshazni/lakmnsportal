<%- include('partials/public-header.ejs') %>

<div>
  <div class="glow-1"></div>
  <div class="glow-2"></div>
  <div class="glow-3"></div>
</div>

<div class="d-lg-flex d-block justify-content-center align-items-center z-2 row g-0 mt-n3 mt-xl-5" style="min-height: 90vh;">

  <div class="py-0 py-xl-5 px-2 px-xl-5 mb-0 order-xl-1 order-md-1 col-12 col-md-6 z-5">
    <div class="card vh-50">
      <div class="card-body">

        <div id="carouselExampleControlsNoTouching" class="carousel slide" data-bs-touch="false" data-bs-interval="false">
          <div class="carousel-inner">
            <div class="carousel-item">
              <img src="https://picsum.photos/1280/720?random=1" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item active">
              <img src="https://picsum.photos/1280/720?random=2" class="d-block w-100" alt="...">
            </div>
            <div class="carousel-item">
              <img src="https://picsum.photos/1280/720?random=3" class="d-block w-100" alt="...">
            </div>
          </div>
          <div class="carousel-indicators position-absolute bottom-3">
            <button type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide-to="1" aria-label="Slide 2"></button>
            <button type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide-to="2" aria-label="Slide 3"></button>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="py-0 py-xl-5 px-2 px-xl-5 mb-0 order-xl-2 order-md-2 col-12 col-md-6 z-5">
    <div class="card vh-50">
      <div class="card-body">

        <div class="slick-slider">
        </div>

        <div class="d-flex justify-content-center mb-3">
          <select class="form-select mx-2" id="add-slide-select">
            <option value="">Select an option</option>
            <option value="https://picsum.photos/1280/720?random=1" data-price="10.00" data-product="Product 1 - RM 10.00">Product 1 - RM 10.00</option>
            <option value="https://picsum.photos/1280/720?random=2" data-price="20.00" data-product="Product 2 - RM 20.00">Product 2 - RM 20.00</option>
            <option value="https://picsum.photos/1280/720?random=3" data-price="30.00" data-product="Product 3 - RM 30.00">Product 3 - RM 30.00</option>
            <option value="https://picsum.photos/1280/720?random=4" data-price="40.00" data-product="Product 4 - RM 40.00">Product 4 - RM 40.00</option>
          </select>
          <button class="btn btn-primary mx-2" id="add-slide-btn">+</button>
        </div>

        <div class="container border pt-3 rounded-3" id="fees">
          <ul class="list-group list-group-flush" id="fees-list">
          </ul>
          <p class="text-end fw-bold">Total: RM <span id="total-fees">0.00</span></p>
        </div>

        <script>
          $(document).ready(function() {
            $('.slick-slider').slick({
              arrows: false,
              dots: true,
              infinite: true,
              speed: 300,
              slidesToShow: 3,
              slidesToScroll: 1,
              responsive: [{
                  breakpoint: 1024,
                  settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    infinite: true,
                    dots: true
                  }
                },
                {
                  breakpoint: 600,
                  settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1
                  }
                },
                {
                  breakpoint: 480,
                  settings: {
                    slidesToShow: 1,
                    slidesToScroll: 1
                  }
                }
              ]
            });

            $('#add-slide-btn').click(function() {
              var index = $('.slick-slider .slick-slide').length;
              var src = $('#add-slide-select').val();
              var text = $('#add-slide-select').find('option:selected').text();
              var fees = parseFloat($('#add-slide-select').find('option:selected').attr('data-price'));
              var product = $('#add-slide-select').find('option:selected').attr('data-product');
              if (src !== '') {
                if ($('#slick-slide-noitems').length > 0) {
                  $('.slick-slider').slick('slickRemove', $('#slick-slide-noitems').attr('data-slick-index'));
                }
                $('.slick-slider').slick('slickAdd', '<div class="card mx-2">' +
                  '<img src="' + src + '" class="card-img-top" alt="...">' +
                  '<div class="card-body d-flex justify-content-center">' +
                  '<p class="card-text mx-auto">' + text + '</p>' +
                  '</div>' +
                  '<div class="card-footer d-flex justify-content-center">' +
                  '<button class="btn btn-danger delete-slide-btn mx-auto" data-index="' + index + '">Delete</button>' +
                  '<p class="mx-2 d-none" data-fees="' + fees + '.00">RM ' + fees + '.00</p>' +
                  '<p class="mx-2 d-none" data-product="' + product + '">' + product + '</p>' +
                  '</div>' +
                  '</div>');
                var totalFees = parseFloat($('#total-fees').text()) + fees;
                $('#total-fees').text(totalFees.toFixed(2));
                $('#fees-list').append('<li class="list-group-item">' + product + ': RM ' + fees + '.00</li>');
              }
            });

            $('.slick-slider').on('click', '.delete-slide-btn', function(event) {
              event.stopPropagation();
              var index = $(this).data('index');
              var fees = parseFloat($(this).siblings('p').attr('data-fees'));
              var product = $(this).siblings('p').attr('data-product');
              $('.slick-slider').slick('slickRemove', index);
              var totalFees = parseFloat($('#total-fees').text()) - fees;
              $('#total-fees').text(totalFees.toFixed(2));
              console.log(index);

              $('#fees-list li:eq(' + index + ')').remove();

              if ($('.slick-slider .slick-slide').length === 0) {
                $('.slick-slider').slick('slickAdd', '<div class="card mx-2" id="slick-slide-noitems">' +
                  '<div class="card-body d-flex justify-content-center">' +
                  '<p class="card-text mx-auto fw-semibold tetx-primary">No items</p>' +
                  '</div>' +
                  '</div>');
                console.log('No slides left');
              } else {
                var new_index = 0;
                $('.slick-slider .slick-slide').each(function() {
                  $(this).find('.delete-slide-btn').data('index', new_index);
                  new_index++;
                });
              }
            });
          });
        </script>

      </div>
    </div>
  </div>

  <%- include('partials/public-footer.ejs') %>